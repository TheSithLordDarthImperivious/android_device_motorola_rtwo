# Motorola Edge 40 Pro/Motorola Edge+ 2023/Moto X40 (Codename: "rtwo") TWRP Port

This is a TWRP device tree for the Motorola Edge 40 Pro/Motorola Edge+ 2023/Moto X40.

# Note

This family of phones uses boot.img's kernel to boot the recovery (kind of like recovery-on-boot, except recovery is on a second ramdisk). As a result, an empty kernel image is provided as a workaround, and please do not flash the recovery.img generated by default. Otherwise, it will throw you

`No valid operating system found` 

when attempting to boot into recovery mode (this will not affect Android itself).

Attempting to boot using fastboot boot will not work; it must be flashed to recovery. Since it has no kernel, fastboot boot recovery.img will result in a boot loop.

# Working Features
- It can boot
- Touchscreen
- File Manager
- CPU Temperature
- Brightness

# Non-working features
- Battery percentage (LineageOS recovery has the same issue)
- fastbootd (please do not try to boot into fastbootd, it may throw your device into a state where it can only boot into Android when "fastboot boot boot.img" is used, and it can only be broken when stock/LineageOS recovery.img is flashed).

# Untested
- Flashing
- Sideload
- Anything else that you may use TWRP for normally

# Instructions to Install

Same as all other TWRP device trees. However, ignore the recovery.img in the `/out/target/product/rtwo` directory and instead run this command from within the root directory of the build system:

```bash
out/host/linux-x86/bin/mkbootimg --ramdisk out/target/product/rtwo/ramdisk-recovery.img --base 0x00000000 --pagesize 4096 --dtb device/motorola/rtwo/prebuilt/dtb.img --os_version 14 --os_patch_level 2024-12-01 --header_version 4 --output recovery.img
```

This is to avoid the "no valid operating system found" error, which can occur if not in the format generated from the command above.

# Credits

- ThEMarD for the LineageOS port (allowed me to find out values from the rtwo device trees, and the command for mkbootimg which can produce working images for rtwo, found from the LineageOS build logs). LineageOS device trees can be found here: https://github.com/moto-sm8550/android_device_motorola_rtwo and here: https://github.com/moto-sm8550/android_device_motorola_sm8550-common
- The person who created the Samsung Galaxy S23 port for TWRP (used as a base, as both phones have the same SoC/Processor): https://github.com/TeamWin/android_device_samsung_dm1q
